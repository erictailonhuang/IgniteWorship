<!DOCTYPE html>
<html lang="en" ng-app="myApp">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="huange">

    <link rel="icon" href="../../favicon.ico">

    <title>SongCloud</title>

    

    <link type="text/css" rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">


    <link type="text/css" rel="stylesheet" href="static/css/style.css">
    <link href="https://fonts.googleapis.com/css?family=Overpass+Mono|Montserrat|Abel" rel="stylesheet">

    <script src="static/js/angular.js"></script>
    
    <script>
        angular.module('myApp', [])
            .filter('orderObjectBy', function() {
                return function(items, field, reverse) {
                    var filtered = [];

                    angular.forEach(items, function(item) {
                        filtered.push(item);
                    });
                    filtered.sort(function (a, b) {
                        return (a[field] > b[field] ? 1 : -1);
                    });
                    if(reverse) filtered.reverse();
                        return filtered;
                };
            })
            .controller('HomeCtrl', function($scope, $http) {

                $scope.keys = ["A", "A#/Bb", "B", "C", "C#/Db", "D", "D#/Eb", "E", "F", "F#/Gb", "G", "G#/Ab"];

                $scope.info = {};
                
                $scope.currentSong = {};
                
                $scope.showAdd = true;
            
                $scope.pullSongListUpdate = function(){
                    $scope.showMainSongDiv = false;
                    $http({
                        method: 'POST',
                        url: '/getSongList',

                    }).then(function(response) {
                        $scope.Songs = response.data;
                        console.log('list o dem songs',$scope.Songs);
                    }, function(error) {
                        console.log(error);
                    });
                }

                $scope.addSong = function(){
                    $http({
                        method: 'POST',
                        url: '/addSong',
                        data: {info:$scope.info}
                    }).then(function(response) {
                        $scope.pullSongListUpdate();
                        $('#addPopUp').modal('hide')
                        $scope.info = {}
                    }, function(error) {
                        console.log(error);
                    });
                }
                
                $scope.editSong = function(id){
                    $scope.info.id = id;
                    $scope.showAdd = false;
                    
                    $http({
                        method: 'POST',
                        url: '/getSong',
                        data: {id:$scope.info.id}
                    }).then(function(response) {
                        console.log(response);
                        $scope.info = response.data;
                        $('#addPopUp').modal('show')
                    }, function(error) {
                        console.log(error);
                    });
                }
                
                $scope.updateSong = function(id){
                    $http({
                        method: 'POST',
                        url: '/updateSong',
                        data: {info:$scope.info}
                    }).then(function(response) {
                        console.log(response.data);
                        $scope.pullSongListUpdate();
                        $('#addPopUp').modal('hide')
                    }, function(error) {
                        console.log(error);
                    });
                }
        
                $scope.showAddPopUp = function(){
                    $scope.showAdd = true;
                    $scope.info = {};
                    $('#addPopUp').modal('show')
                }

                $scope.clearSongDisplay = function(){
                    $scope.showMainSongDiv = false;
                    $scope.showToolbarOptions = false;
                }
                
                $scope.showSong = function(id){
                    $scope.info.id = id;
                    $scope.showMainSongDiv = true;
                    $scope.showToolbarOptions = true;
                    
                    $http({
                        method: 'POST',
                        url: '/getSong',
                        data: {id:$scope.info.id}
                    }).then(function(response) {
                        console.log("display dis song", response);
                        $scope.currentSong = response.data;
                    }, function(error) {
                        console.log(error);
                    });
                }
                
                $scope.confirmDelete = function(id){
                    $scope.deleteSongId = id;
                    $('#deleteConfirm').modal('show');
                }
                
                $scope.deleteSong = function(){
                    $http({
                        method: 'POST',
                        url: '/deleteSong',
                        data: {id:$scope.deleteSongId}
                    }).then(function(response) {
                        console.log(response.data);
                        $scope.deleteSongId = '';
                        $scope.pullSongListUpdate();
                        $('#deleteConfirm').modal('hide')
                    }, function(error) {
                        console.log(error);
                    });
                }
                
                $scope.pullSongListUpdate();
            });
    </script>


</head>

<body ng-controller="HomeCtrl">

<!-- song sidebar -->
    <div id="sidebar" class="col-3">

        <div id="titleBar">
            <a href="/" id="title">SONGCLOUD</a>
            <button ng-click="showAddPopUp()" id="addNewSongBtn">
                <span class="glyphicon glyphicon-plus"></span> NEW
            </button>
        </div>

        <div>
            <form id = "searchDiv">
                <div class="input-group">
                    <div class="input-group-btn">
                        <button class="btn btn-default" type="submit" id ="searchBar">
                            <i class="glyphicon glyphicon-search"></i>
                        </button>
                    </div>
                    <input type="text" placeholder="" id= "searchBar"  ng-model="query">
                </div>
            </form>
        </div>

        <div id="songList">
            <table class="table">
                <tbody>
                    <tr ng-repeat="song in Songs | filter:query | orderObjectBy:'songName'">
                        <th id="songitem" ng-click="showSong(song.id)">
                            <font class="alignleft" size="2">
                                {{'{{song.songName}}'}}
                            </font>
                            <br>
                            <font class="alignright" size="1" color="gray">
                                {{'{{song.artist}}'}}
                            </font>
                        </th>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="toolbar" ng-model="currentSong" >
        <table class="table" id="toolbarTable">
            <thead id="toolBar">
                <tr id="toolbarContent">
                    <td ng-show="showToolbarOptions">
                        <div class="dropdown">
                            <button class="btn btn-xs dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" ng-bind="currentSong.key">
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenu1" id="ddMenu" >
                                <li><a href="#">A</a></li>
                                <li><a href="#">A#/Bb</a></li>
                                <li><a href="#">B</a></li>
                                <li><a href="#">C</a></li>
                                <li><a href="#">C#/Db</a></li>
                                <li><a href="#">D</a></li>
                                <li><a href="#">D#/Eb</a></li>
                                <li><a href="#">E</a></li>
                                <li><a href="#">F</a></li>
                                <li><a href="#">F#/Gb</a></li>
                                <li><a href="#">G</a></li>
                                <li><a href="#">G#/Ab</a></li>
                            </ul>
                        </div>
                    </td>
                    <td ng-show="showToolbarOptions">
                        <span style="cursor:pointer; color:#adadad" ng-click="editSong(currentSong.id)" class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                    </td>
                    <td ng-show="showToolbarOptions">
                        <span style="cursor:pointer; color:#adadad;" ng-click="confirmDelete(currentSong.id)" class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                    </td>
                    <td ng-show="showToolbarOptions">
                        <span style="cursor:pointer; color:#43b2e7;" ng-click="clearSongDisplay()" class="glyphicon glyphicon-remove-circle"></span>
                    </td>
                </tr>
            </thead>
        </table>
    </div>


<!-- main song content area -->
    <div ng-show="showMainSongDiv" id="mainDisplay" class="col-9" ng-model="currentSong">
        <table class="table" id="songHeader">
            <thead>
                <h2><span ng-bind="currentSong.songName"></span></h2>
                <tr>
                    <th width="30%">Artist</th>
                    <th width="30%">Author</th>
                    <th width="15%">BPM</th>
                </tr>
            </thead>
            <tbody>
                <td><span ng-bind="currentSong.artist"></span></td>
                <td><span ng-bind="currentSong.author"></span></td>
                <td><span ng-bind="currentSong.bpm"></span></td>
                
            </tbody>
        </table>
        <div id="lyricsDisplayDiv">
            <span id="lyricsDisplay" ng-bind="currentSong.lyrics"></span>
        </div>
    </div>
        


<!-- add song form popup -->
    <div class="modal fade" id="addPopUp" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="exampleModalLabel">Song Editor</h4>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label for="txtsongName" class="control-label">Song Name:</label>
                            <input type="text" class="form-control" ng-model="info.songName" id="txtsongName"></input>
                        </div>
                        <div class="form-group">
                            <label for="txtArtist" class="control-label">Artist:</label>
                            <input type="text" class="form-control" ng-model="info.artist" id="txtArtist"></input>
                        </div>
                        <div class="form-group">
                            <label for="txtAuthor" class="control-label">Author:</label>
                            <input type="text" class="form-control" ng-model="info.author" id="txtAuthor"></input>
                        </div>
                        <div class="form-group">
                            <label for="txtBPM" class="control-label">BPM:</label>
                            <input type="text" class="form-control" ng-model="info.bpm" id="txtBPM"></input>
                        </div>
                        <div class="form-group">
                            <label for="txtKey" class="control-label">Default Key:</label>
                            <select ng-model="info.key" id="txtKey" ng-options="item for item in keys"></select>
                        </div>
                        <!-- split to another page? -->
                        <div class="form-group">
                            <label for="txtLyrics" class="control-label">Compose Song</label>
                            <textarea rows="4" cols="50" type="text" id="txtboxLyricsInput" class="form-control" ng-model="info.lyrics" id="txtLyrics"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button"  class="btn btn-default" data-dismiss="modal">Close</button>
                    <button ng-show="showAdd" id="btnAdd" ng-click="addSong()" type="button" class="btn btn-primary">Save Song</button>
            
                    <button ng-show="!showAdd" id="btnAdd" ng-click="updateSong()" type="button" class="btn btn-primary">Update Song</button>
                </div>
            </div>
        </div>
    </div>

<!-- delete confirmation -->
    <div id="deleteConfirm" class="modal fade bs-example-modal-md in" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                    <h4 class="modal-title" id="myLargeModalLabel">Are you sure you want to delete this Song?</h4> </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" ng-click="deleteSong()" class="btn btn-primary">Delete</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="static/js/jquery.min.js"></script>
    <script src="https://npmcdn.com/tether@1.2.4/dist/js/tether.min.js"></script>
    <script src="https://npmcdn.com/bootstrap@4.0.0-alpha.5/dist/js/bootstrap.min.js"></script>

</body>

</html>
